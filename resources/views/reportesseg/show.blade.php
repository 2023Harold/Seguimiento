<html>
<table>
    <thead>
        <tr>
            <th rowspan=3 style="color: white; background-color: #A13B71; border:solid;" align="center" valign="center" width="150px" > Tipo de Entidad </th>                          
            <th rowspan=3 style="color: white; background-color: #A13B71; border:solid;" align="center" valign="center" width="150px"> Núm. Progresivo </th>                    
            <th rowspan=3 style="color: white; background-color: #A13B71; border:solid;" align="center" valign="center" width="150px"> Núm. Entidad/ Siglas </th>
            <th rowspan=3 style="color: white; background-color: #A13B71; border:solid;" align="center" valign="center" width="150px"> Tipo de Entidad </th>
            <th rowspan=3 style="color: white; background-color: #A13B71; border:solid;" align="center" valign="center" width="400px"> Auditoría PAA </th>
            <th rowspan=3 style="color: white; background-color: #A13B71; border:solid;" align="center" valign="center" width="200px"> Tipo Auditoría </th> 
            <th rowspan=3 style="color: white; background-color: #A13B71; border:solid;" align="center" valign="center" width="300px"> Periodo Auditado </th> 
            <th rowspan=3 style="color: white; background-color: #A13B71; border:solid;" align="center" valign="center" width="150px"> Año Auditado </th>
            <th rowspan=3 style="color: white; background-color: #A13B71; border:solid;" align="center" valign="center" width="200px"> Núm. de Auditoría </th>
            <th rowspan=3 style="color: black; background-color: yellow; border:solid;" align="center" valign="center" width="250px"> Fecha de recepción del expediente </th>
            <th rowspan=3 style="color: white; background-color: #A13B71; border:solid;" align="center" valign="center" width="250px"> Núm. de expediente (interno US) </th>
            <th rowspan=3 style="color: black; background-color: yellow; border:solid;" align="center" valign="center" width="250px"> Fecha del acuerdo de radicación </th>
            <th rowspan=3 style="color: white; background-color: #A13B71; border:solid;" align="center" valign="center" width="200px"> Fecha de comparecencia</th>
            <th rowspan=2 colspan=2 style="color: black; background-color: yellow; border:solid;" align="center" valign="center" width="300px"> Oficio donde se notifican los acuerdos </th>                                                         
            <th colspan=9 style="color: white; background-color: #A13B71; border:solid;" align="center" valign="center" width="1700px"> Etapa de Aclaración </th> 
            <th colspan=5 style="color: white; background-color: #A13B71; border:solid;" align="center" valign="center" width="1350px"> Etapa de atención de Recomendaciones</th>
            <th rowspan=2 colspan=5 style="color: white; background-color: #A13B71; border:solid;" align="center" valign="center" width="500px"> Acciones Promovidas 1.° Etapa  </th>
            <th rowspan=2 colspan=2 style="color: black; background-color: yellow; border:solid;" align="center" valign="center" width="300px"> Acciones promovidas </th>  
            <th rowspan=2 colspan=2 style="color: white; background-color: #A13B71; border:solid;" align="center" valign="center" width="300px"> Acciones promovidas solventadas </th>   
            <th rowspan=2 colspan=2 style="color: white; background-color: #A13B71; border:solid;" align="center" valign="center" width="300px"> Acciones promovidas no solventadas </th>
            <th rowspan=3 style="color: white; background-color: #A13B71; border:solid;" align="center" valign="center" width="200px"> Área en que sencuentra </th>                             
            <th rowspan=3 style="color: white; background-color: red; border:solid;" align="center" valign="center" width="600px"> Parte del Proceso de Seguimiento en que se encuentra la Auditoría Etapa aclaración </th>
            <th rowspan=3 style="color: white; background-color: red; border:solid;" align="center" valign="center" width="600px"> Parte del Proceso de Seguimiento en que se encuentra la Auditoría Atención de las Recom. </th>
            <th rowspan=3 style="color: white; background-color: red; border:solid;" align="center" valign="center" width="600px"> Fecha de acuse de la conclusión de la Etapa de Aclaración </th>
            <th rowspan=3 style="color: white; background-color: red; border:solid;" align="center" valign="center" width="600px"> Fecha de acuse de la conclusión al proceso de atención de las recom.</th>
            <th rowspan=3 style="color: white; background-color: red; border:solid;" align="center" valign="center" width="600px"> Fecha de acuse de oficio de notif. del informe de seguimiento de la etapa de aclaración </th>
            <th rowspan=3 style="color: white; background-color: red; border:solid;" align="center" valign="center" width="800px"> Fecha de acuse de oficio de notif. del informe de seguimiento al proceso de atención de las recom. </th>
            <th rowspan=3 style="color: white; background-color: #A13B71; border:solid;" align="center" valign="center" width="200px"> Fecha de envío a la UI. </th>
            <th rowspan=3 style="color: white; background-color: #A13B71; border:solid;" align="center" valign="center" width="200px"> Fecha de envío a la OIC </th>
            <th rowspan=2 colspan=4 style="color: white; background-color: #A13B71; border:solid;" align="center" valign="center" width="2400px"> Asignación</th>
            <th rowspan=2 colspan=4 style="color: white; background-color: red; border:solid;" align="center" valign="center" width="900px"> Contestaciones</th>                            
        </tr>  
        <tr>                              
            <th colspan=3 style="color: white; background-color: #A13B71; border:solid;" align="center" valign="center" width="700px"> Fechas </th>
            <th colspan=2 style="color: white; background-color: #A13B71; border:solid;" align="center" valign="center" width="300px"> Pliegos de Observaciones Promovidos </th>
            <th colspan=2 style="color: white; background-color: #A13B71; border:solid;" align="center" valign="center" width="300px"> Pliegos de observaciones solventados</th>
            <th colspan=2 style="color: white; background-color: #A13B71; border:solid;" align="center" valign="center" width="300px"> Pliegos de Observaciones No Solventados </th>
            <th colspan=2 style="color: white; background-color: red; border:solid;" align="center" valign="center" width="600px"> Proceso de Atención </th>    
            <th style="color: white; background-color: #A13B71; border:solid;" align="center" valign="center" width="200px"> Recomendaciones Promovidas </th>    
            <th style="color: white; background-color: #A13B71; border:solid;" align="center" valign="center" width="200px"> Recomendaciones Atendidas </th>    
            <th style="color: white; background-color: #A13B71; border:solid;" align="center" valign="center" width="200px"> Recomendaciones No Atendidas </th>                                                        
        </tr> 
        <tr> 
            <th style="color: black; background-color: yellow; border:solid;" align="center" valign="center" width="150px"> Fecha </th>
            <th style="color: black; background-color: yellow; border:solid;" align="center" valign="center" width="150px"> Número</th>
            <th style="color: white; background-color: #A13B71; border:solid;" align="center" valign="center" width="200px"> Notificación</th>
            <th style="color: white; background-color: #A13B71; border:solid;" align="center" valign="center" width="200px"> Vencimiento</th>
            <th style="color: white; background-color: #A13B71; border:solid;" align="center" valign="center" width="300px"> 120 días de la etapa de Seguimiento</th>
            <th style="color: white; background-color: #A13B71; border:solid;" align="center" valign="center" width="150px"> Núm. Obs. </th>
            <th style="color: white; background-color: #A13B71; border:solid;" align="center" valign="center" width="150px"> Importe</th>
            <th style="color: white; background-color: #A13B71; border:solid;" align="center" valign="center" width="150px"> Núm. Obs. </th>
            <th style="color: white; background-color: #A13B71; border:solid;" align="center" valign="center" width="150px"> Importe </th>
            <th style="color: white; background-color: #A13B71; border:solid;" align="center" valign="center" width="150px"> Núm. Obs. </th>
            <th style="color: white; background-color: #A13B71; border:solid;" align="center" valign="center" width="150px"> Importe </th>
            <th style="color: white; background-color: red; border:solid;" align="center" valign="center" width="300px"> Plazo Convenido </th>
            <th style="color: white; background-color: red; border:solid;" align="center" valign="center" width="300px"> Fecha termino </th>
            <th style="color: white; background-color: #A13B71; border:solid;" align="center" valign="center" width="250px"> Núm. Obs. </th>
            <th style="color: white; background-color: #A13B71; border:solid;" align="center" valign="center" width="250px"> Núm. Obs. </th>
            <th style="color: white; background-color: #A13B71; border:solid;" align="center" valign="center" width="250px"> Núm. Obs. </th>
            <th style="color: white; background-color: #A13B71; border:solid;" align="center" valign="center" width="100px"> PO </th>
            <th style="color: white; background-color: #A13B71; border:solid;" align="center" valign="center" width="100px"> SA </th>
            <th style="color: white; background-color: #A13B71; border:solid;" align="center" valign="center" width="100px"> R </th>
            <th style="color: white; background-color: #A13B71; border:solid;" align="center" valign="center" width="100px"> PRAS </th>
            <th style="color: white; background-color: #A13B71; border:solid;" align="center" valign="center" width="100px"> Total</th>
            <th style="color: black; background-color: yellow; border:solid;" align="center" valign="center" width="150px"> Núm. Obs. </th>
            <th style="color: black; background-color: yellow; border:solid;" align="center" valign="center" width="150px"> Importe </th>
            <th style="color: white; background-color: #A13B71; border:solid;" align="center" valign="center" width="150px"> Núm. Obs. </th>
            <th style="color: white; background-color: #A13B71; border:solid;" align="center" valign="center" width="150px"> Importe </th>
            <th style="color: white; background-color: #A13B71; border:solid;" align="center" valign="center" width="150px"> Núm. Obs. </th>
            <th style="color: white; background-color: #A13B71; border:solid;" align="center" valign="center" width="150px"> Importe </th>
            <th style="color: black; background-color: yellow; border:solid;" align="center" valign="center" width="800px"> Analista </th>
            <th style="color: black; background-color: yellow; border:solid;" align="center" valign="center" width="800px"> Líder de proyecto </th>                            
            <th style="color: white; background-color: #A13B71; border:solid;" align="center" valign="center" width="400px"> Jefe de departamento </th>
            <th style="color: white; background-color: #A13B71; border:solid;" align="center" valign="center" width="400px"> Direccion </th>
            <th style="color: white; background-color: red; border:solid;" align="center" valign="center" width="200px"> Recibidas </th>
            <th style="color: white; background-color: red; border:solid;" align="center" valign="center" width="200px"> Atendidas </th>
            <th style="color: white; background-color: red; border:solid;" align="center" valign="center" width="200px"> Pendientes </th>
            <th style="color: white; background-color: red; border:solid;" align="center" valign="center" width="300px"> Fecha de última contestación </th>
        </tr>                             
    </thead>
    <tbody>
        @forelse ($auditorias as $auditoria)
            <tr>
                <td class="text-center bg-danger">
                        {{ $auditoria->tipoEntidadAmbito=='PODER EJECUTIVO'?'ESTATAL':$auditoria->tipoEntidadAmbito}}
                </td>
                <td class="text-center bg-light-dark">{{ str_pad($loop->iteration, 3, '0', STR_PAD_LEFT) }}</td>                                                             
                <td class="text-center">                                    
                    @if (!empty($auditoria->siglas_entidad))
                    {{ $auditoria->siglas_entidad }}
                    @else
                    {{ $auditoria->entidad_fiscalizable_id }}
                    @endif
                </td>
                <td class="text-center bg-light-dark">
                    {{ $auditoria->tipo_entidad }}
                </td>
                <td>
                    @php
                        $entidadparciales = explode("-", $auditoria->entidad_fiscalizable);
                    @endphp
                    @foreach ($entidadparciales as $entidadparcial)
                        {{ mb_convert_encoding(mb_convert_case(strtolower($entidadparcial), MB_CASE_TITLE), "UTF-8"); }} 
                        @if (end($entidadparciales)!=$entidadparcial)
                        <br>
                        @endif
                    @endforeach
                </td>
                <td class="bg-light-dark">
                    {{ $auditoria->acto_fiscalizacion }}                                    
                </td> 
                <td>
                    {{ $auditoria->periodo_revision }}                                    
                </td>     
                    {{-- año auditado --}}
                <td class="text-center bg-light-dark">                                       
                    {{ $auditoria->periodoAnio}}                                       
                </td> 
                {{-- Núm. de Auditoría	 --}}
                <td class="text-center bg-light-dark">                                       
                    {{ $auditoria->tipo_auditoria->sigla.' - '.$auditoria->numero_auditoria }}                                     
                </td>
                {{-- fecha del acuerdo de radicación --}}
                <td class="text-center bg-warning">   
                    @if (!empty($auditoria->radicacion->fecha_expediente_turnado))                                                                                                                                                                   
                    {{ fecha($auditoria->radicacion->fecha_expediente_turnado)}}
                    @endif                                       
                </td> 
                {{-- Núm. de expediente (interno US)	--}}                                
                <td class="text-center bg-light-dark"> 
                    @if (!empty( $auditoria->radicacion->numero_expediente))                                                                                                                                                                                
                    {{  $auditoria->radicacion->numero_expediente}}                                     
                    @endif                                                         
                </td> 
                 {{--Fecha del acuerdo de radicacióN --}}
                <td class="text-center bg-warning">                         
                    @if(!empty($auditoria->radicacion->fecha_notificacion))                                  
                    {{ fecha($auditoria->radicacion->fecha_notificacion)}}                                                         
                    @endif
                </td>  
                {{--  Fecha de comparecencia	--}}
                <td class="text-center bg-light-dark"> 
                    @if(!empty($auditoria->comparecencia->fecha_comparecencia))                                      
                    {{ fecha($auditoria->comparecencia->fecha_comparecencia)}}
                    @endif                                     
                </td> 
                <td class="text-center bg-warning">  
                    @if(!empty($auditoria->radicacion->fecha_notificacion))
                    {{ fecha($auditoria->radicacion->fecha_notificacion)}}                                     
                    @endif                                          
                </td>                             
                <td class="text-center bg-warning">                                       
                    @if(!empty($auditoria->radicacion->num_memo_recepcion_expediente))
                    {{ $auditoria->radicacion->num_memo_recepcion_expediente}}                                     
                    @endif
                </td>                 
                <td class="text-center bg-light-dark">
                    @if(!empty($auditoria->comparecencia->fecha_inicio_aclaracion))
                    {{ fecha($auditoria->comparecencia->fecha_inicio_aclaracion)}}    
                    @endif 
                </td>
                <td class="text-center">                    
                @if(!empty($auditoria->comparecencia->fecha_termino_aclaracion))
                {{ fecha($auditoria->comparecencia->fecha_termino_aclaracion)}}
                @endif                
                </td>
                 {{-- 120 días de la etapa de Seguimiento	 --}}
                 <td class="text-center">
                @if(!empty(fecha($auditoria->radicacion->calculo_fecha)))
                {{ fecha($auditoria->radicacion->calculo_fecha)}}
                @endif               
                </td>
                <td class="bg-light-dark text-center">
                    {{  $auditoria->totalpliegos->count()}} 
                </td>
                <td style="text-align: right!important;">                                    
                    {{ '$'.number_format( $auditoria->totalpliegos->sum('monto_aclarar'), 2) }}  
                </td>
                <td class="text-center bg-light-dark">
                    {{  $auditoria->totalsolventadopliegos->count()}}
                </td>
                <td style="text-align: right!important;">
                    {{ '$'.number_format( $auditoria->totalsolventadopliegos->sum('monto_aclarar'), 2) }}
                </td>
                <td class="text-center bg-light-dark">
                    {{  $auditoria->totalNOsolventadopliegos->count()}}
                </td>
                <td style="text-align: right!important;">
                    {{ '$'.number_format( $auditoria->totalNOsolventadopliegos->sum('monto_aclarar'), 2) }}
                </td>
                {{-- Plazo Convenido	 --}}
                <td class="bg-danger text-center">
                @if (!empty( $auditoria->radicacion->plazo_maximo))                                                                                                                                                                                
                {{ $auditoria->radicacion->plazo_maximo}} días hábiles                                     
                @endif     
                </td>
                {{-- fecha termino --}}
                @if (!empty( $auditoria->radicacion->calculo_fecha))    
                {{ fecha($auditoria->radicacion->calculo_fecha)}}
                @endif
                <td class="text-center bg-light-dark">
                    {{  $auditoria->totalrecomendacion->count()}}
                </td>
                <td class="text-center">                                    
                    {{  $auditoria->totalsolventadorecomendacion->count()}}
                </td>
                <td class="text-center bg-light-dark">
                    {{  $auditoria->totalNOsolventadorecomendacion->count()}}
                </td>
                <td class="text-center">
                    {{  $auditoria->totalpliegos->count()}} 
                </td>
                <td class="text-center bg-light-dark">
                    {{  $auditoria->totalsolacl->count()}} 
                </td>
                <td class="text-center">
                    {{  $auditoria->totalrecomendacion->count()}} 
                </td>
                <td class="text-center bg-light-dark">
                    {{  $auditoria->totalpras->count()}} 
                </td>
                <td class="text-center">
                    {{ $auditoria->acciones->count() }} 
                </td>
                {{-- Nota:  Se contemplan los PRAS   --}}
                <td class="text-center bg-warning">                                       
                    {{ $auditoria->acciones->count() }}                                     
                </td> 
                <td class="bg-warning" style="text-align: right!important;">  
                    {{ '$'.number_format(  $auditoria->total(), 2) }}  
                </td>
                <td class="text-center bg-light-dark">                                       
                    {{ $auditoria->totalsolventadorecomendacion->count() + $auditoria->totalsolventadopras->count() +  $auditoria->totalsolventadosolacl->count() + $auditoria->totalsolventadopliegos->count()}}                                     
                </td>                           
                <td style="text-align: right!important;"> 
                    {{ '$'.number_format( ($auditoria->totalsolventadorecomendacion->sum('monto_aclarar') + $auditoria->totalsolventadopras->sum('monto_aclarar') +  $auditoria->totalsolventadosolacl->sum('monto_aclarar') + $auditoria->totalsolventadopliegos->sum('monto_aclarar')), 2) }} </td>                           
                <td class="text-center bg-light-dark">                                       
                    {{ $auditoria->totalNOsolventadorecomendacion->count() + $auditoria->totalNOsolventadopras->count() +  $auditoria->totalNOsolventadosolacl->count() + $auditoria->totalNOsolventadopliegos->count()}}                                     
                </td>                           
                <td style="text-align: right!important;"> 
                    {{ '$'.number_format(($auditoria->totalNOsolventadorecomendacion->sum('monto_aclarar') + $auditoria->totalNOsolventadopras->sum('monto_aclarar') +  $auditoria->totalNOsolventadosolacl->sum('monto_aclarar') + $auditoria->totalNOsolventadopliegos->sum('monto_aclarar')), 2) }} 
                </td>   
                <td class="text-center bg-light-dark">                                       
                   US
                </td>  
                <td class="text-center bg-danger">
                    EN ANÁLISIS
                </td>
                <td class="text-center bg-danger">
                    NO APLICA
                </td>

                {{-- Fecha de acuse de la conclusión de la Etapa de Aclaración	 --}}
                <td class="text-center bg-danger">
                @if (!empty($auditoria->acuerdoconclusion->fecha_acuerdo_conclusion))                                                                                                                                                                                
                {{ fecha($auditoria->acuerdoconclusion->fecha_acuerdo_conclusion)}}                                     
                @endif  
                </td>

                 {{--  Fecha de acuse de la conclusión al proceso de atención de las recom.	--}}
                <td class="text-center bg-danger"></td>
                @if (!empty($auditoria->comparecencia->fecha_termino_proceso))                                                                                                                                                                                
                {{ fecha($auditoria->comparecencia->fecha_termino_proceso)}}                                     
                 @endif   

                {{--Fecha de acuse de oficio de notif. del informe de seguimiento de la etapa de aclaración	 --}}
                <td class="text-center bg-danger">
                 @if (!empty($auditoria->informeprimeraetapa->fecha_notificacion))                                                                                                                                                                                
                 {{fecha($auditoria->informeprimeraetapa->fecha_notificacion)}}                                     
                 @endif    
                </td>

                {{-- Fecha de acuse de oficio de notif. del informe de seguimiento al proceso de atención de las recom.	 --}}
                <td class="text-center bg-danger">
               
                </td>
                {{-- Fecha de envío a la UI.--}} 
                <td class="text-center">   
                    @if (!empty($auditoria->turnoui->fecha_notificacion_ui))                                                                                                                                                                                
                    {{fecha($auditoria->turnoui->fecha_notificacion_ui)}}        
                    @endif                                  
                </td>
                {{-- Fecha de envío a la OIC --}}
                <td class="bg-light-dark">
                    @if (!empty($auditoria->turnooic->fecha_envio))                                                                                                                                                                                
                    {{ fecha($auditoria->turnooic->fecha_envio) }} 
                    @endif   
                </td>
                <td class="bg-warning">
                    @php
                        $analistas='';
                        
                        foreach ($auditoria->acciones as $accion) {
                            if(!str_contains($analistas, $accion->analista_asignado))
                            $analistas=$analistas.$accion->analista_asignado.', ';                                            
                        }
                        $analistas = substr($analistas, 0, -2);

                    @endphp                                   
                     {{$analistas}}
                </td>
                <td class="bg-warning">
                    @php
                    $lideres='';                                    
                    foreach ($auditoria->acciones as $accion) {
                        if(!str_contains($lideres, $accion->lider_asignado))
                        $lideres=$lideres.$accion->lider_asignado.', ';                                            
                    }
                    $lideres = substr($lideres, 0, -2);
                    @endphp                                   
                    {{$lideres}}
                </td>
                <td class="text-center">.
					@if(!empty($auditoria->departamento_encargado))
						{{$auditoria->departamento_encargado}}<br>
						{{ $auditoria->jefedepartamentoencargado->name}} 
					@endif  
                </td>
                <td class="text-center bg-light-dark">
					@if(!empty($auditoria->direccion_asignada))
						{{ $auditoria->direccion_asignada}} <br>
						{{ $auditoria->directorasignado->name}} <br>
					@endif  
                </td>
                <td class="bg-danger"></td>
                <td class="bg-danger"></td>
                <td class="bg-danger"></td>
                <td class="bg-danger"></td>
                                   
            </tr>
        @empty
            <tr>
                <td class="text-center" colspan="8">
                    <span class='text-center'>No hay registros en éste apartado</span>
                </td>
            </tr>
        @endforelse
    </tbody>
</table>
</html>